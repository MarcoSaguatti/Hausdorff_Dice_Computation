# Hausdorff Dice Computation
This program calculates 95 percentile Hausdorff distance (HD), volumetric Dice similarity coefficient (DSC) and surface Dice similarity coefficient (SDSC) between manually contoured and automatically contoured pelvic structures.
Particularly, it computes these metrics for five organs at risk (i.e. prostate, rectum, bladder, left femur and right femur) contoured in three different ways: manually, using a deep learning segmentation algorithm and using a model based segmentation algorithm.
The final output is stored in a .xlsx file.

![metrics](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQgBvMhw2ZldlQbHbJrwLL5x0ijLdY9XQM-ww&usqp=CAU)

### Hausdorff distance
HD is the greatest of all distances from a point in one contour surface to the closest point in the other contour surface.

![Hausdorff](https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Hausdorff_distance_sample.svg/250px-Hausdorff_distance_sample.svg.png)

### Dice similarity coefficient
DSC measures the spatial overlap between two segmentation volumes and it ranges from 0 (no overlap) to 1 (perfect overlap).

SDSC is exactly the same with the difference that the overlap is measured between two segmentation surfaces.

![Dice](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT8AAACeCAMAAABzT/1mAAABpFBMVEX///8AAAD/v7/W5vSTk5P09PSysrL/wsLd3d3/xsb/x8fZ6ffd7vzb7Prf7/7qtL//4uLs8/r/vLz/lZXk7vf/0dH/nZ3G1eL/pKT/tLT/q6v/sbH/+fmNjY3kr7r/7++pqaniqqp7hIzwtbVaYWe3xdFQVluLlZ6YpK7P3+yptsFJNzdzfIP/n5+yyNtqcXh7X2X/19fT09PDw8M+Pj56enocFRUxJSU/REjUoKCkfHybprFrUlK6jY3psLCTb2+xvsooHh7V3eTOnqi4jZZZRUmfeoJnZ2caHB6tg4PIl5dYXmR/YWErLjGCY2OXc3P//vAfAAA8LjGju9D/i4swNDdgSkrDurBnUELy5tdue42mmIs6QFKHdVpEUV5kW1GEdGc9LRiInLIWKEKQh3jOuqbHbHkjGygxKSLojpf+8d5KYnHZ0MBZcpHc1OEAABReNTiojJS2W2GTS0/fytbtoKv/FRX/SEj/W1v/eXn/AAA1AADPtcDUh499Sk69pKRZISHTcXHLh4deVGEUIi1sTzGrk3uua2uXPz94Pz97FhYuO0fpCeQxAAAVJ0lEQVR4nO2djV8TV9bH54VkEibhJQmZvJAQhElIlFACQRBRCGgQRFGqPmiV1tY+y6Pttuu6L0+f6trtbtvtP/3c15l7Q8LckKgXzPm0NpMJw/jtPed3zrl3bhRFAvPVLLtMzLZqvpYfHOpPphLxKLDpRDoyO/qubiigitq7ugNxiwF0Rd10rQgg1pp8sD8RTUQM1yLpaDw59k7u6fTws8qW3sSKZZsfhUOpaFrTtAhn4Hg6HnwHd3VK+Pnssm7GhptYzDTL9rDzwaHpaUMbamaGkYxqXb+x08HPAvR0PdbsVAyMQUAQH4wmEoahRZpew9A0IxId6fKdnQZ+vr2iCV0V8pt8UJgDo+2/dPC6AoddDLtxGcbBkagGLQLUYv/ho1JFUXY/A2/PzcGTBjxlpKa7KyWngF+tbGJGgN/jJwczBUX5fPXAUna/eKo4/EzLVtJpg/Lb/WJmvlpS9vOV7eHdLwNfmIQfsPhQN29Ofn52keCD/PaffH5hWTnIZfq+Kj2znygOP90sfh0hiOD4e/Aw32fvb+cyuYPAf2fgByk/I9FNHZGeX9mVWsDvQf4Pi/PWbjWTKSmPZ9ZC7vj79nBwY8kZf8qj/EL+yfB+NVPVgQ8/Lrv8NCOd7N7tyc6PwYf41efr52L/8zzw4pvdL5VnTyk/gG/9E1WdMCi/XH6+PqU8mwo82tv9Y+4POsNP05Lprt2f5PxYfIjf8IPhF7XdjN9fUkDa5yP8zG+/vg9u8drGBOXnV3KKf/jFlD9XVHwoQWT4acmujUC5+dl6A7+jBvmF7O/ADV5eHxzcoPyOGstPS3crBkrNzyoK8QvNgNv7BNADLnwrqLXO/1wzEl1SYZn5xWji4mGh79VPsogecOF1jlNLM+LdyQNl5rcnhk//8ytIDwbA++uD6xNC/DRjuiv3KDE/25scsvBhdnDjGnHh7NVPgmIA010p5eTlN1z2RofwZbMbdyk96MKiHhztxl3Ky08w+JkDf4L0rmYJvfMbG2LjT4s015n2TFp+MbHhZ65ugnu77soHwPg+B6C0/GzB4Wera9epfIAMEDrzNTF+WqQL7UBZ+flE3XdwA9Bz5eP6RfBq/P0NQFn5Ne3VN7HwIaDnyMf1BRUOR0EH1rqQRMvKTzT3qx2iEYfk4yp4cRE683UxfJqR6vg+JeUn6r7693dUdeE6Fd+7G3AQrqlL782BJeXXUPm2tKJK5AOnLtSFb4gWcR1PakrKT1B99dBLRO+ySlIX5MIbgxuiCtxxG0ZSfuLhj4jv5XV2EG4IFsFax43U083P/POrjfMqaV6hQYgD4F3RJkKi0xuVk59w9vc9TV1o+wUHQOEaON7pnX5gfmN//7RZCK8Jpn/hRZy6OC6cva7CHGbwvZVwH5jfX0aSf8WvQCQfcVqaNUH5DW8getSFnRxGnF+nXdQP7r+Rv+H/jkQMtx8imr6EXw2S5hWfw6wJCnDnXegPzc/4C/0bRP/uvitcvb0CyTLOnxn5AAHwplgT1ZjuNAH8wPxG/kZfRUZm3WpKePzt0PzZCYC4iHtvsyAflt/o/0ajJITPgn/aj38ZRM9tv9AA+JHEv9H+YLBZCSCsv69Y+aABMDu4/rHobwsTzv/I3MdVpojLQmde+Ujyv1YmWn98S9svNAMkU3GXBPmd0fpDvP79YfM648JZ0ksVnUI6s/WvaP8l/DZL+8/ZwSzq3i8AZxbuv/R3eqOS8hMW4FeDtP+cRYkfdObshnD6clb7f8IC8n+YWZbOfeD8+aPvPwsHQP2HNUQPps24ew/vVXQC7szOf4hXcD8Cek7lu47z5978WxsO/MqpfJ38uTf/K67A5m8q6d7T/Dkrmr0kjc5vU1p+gutf9PAyrt3c/Plqb/0LNNEZYPPQbSBkUSZ9RWz4ne31V8IRMOxWH3j1y20xfGd9/Z/w+tPQa7J+A+fP64LrT1NnfP2peBPBesmsflkX9F7tzK9/Fl5/H85mSeMUvOitv3dNuI0Piw6Y+IHcRbRx9RE8/yEcAk0LzxytC6d+6Y4bL8Tk5qcIJoGmdZgFAfDauiC+ZDdSF2SS8xMG+O3X4BYvToh578fz/KU4wJp67bomhM9Id230nQJ+im0JqbBpOc+fe+BLdCv2QZOfn7v/wfH4LCWdEgEY/cj2P4CVXNGDoOnsv+FB0EglPrr9NxS6/8sx9Mj+L0pq+jiCRjI62+U7Ox38FF9rgnD/IXcHp6FUvAVBuP9Q93dwOiX8gFl7AKHZyM609hr2vxqD+18ZRiO8SDzeTd2gdnr4Kcow3H/NFNh/bSQVnU4y+69p4Dhyevdfa71LX/uXqtl2eQ9b2bZaX3ksmE5EP4UWjSeSEu3/55ub8wfwy4o/gP4C5A1/Hr8/51y8MueHp/z5LhKUzNoff/lMILcDgeTnAos5cIX5SkCFlOr4fJ87UitqIFAFb/vUMwuwfX47FUXJVBUlB/6tBDAbP3ifMPJVXX7+bcgOvMjV3/ff631Z+/4LX8yBP/ry6Ljah9/340Ol7nP5VXMEnU8C9Xk31ja/yqaC+flUNKhUEgyrGXy6T3Gddb6ay2C85FP5eWz4NIiOp93a5wfdlgyq/A7kT96v5zAhRdkMUH6qz0c8d8cVFdc2hX+3tNY+P8SJ4FDnlLl5jp+/2tenVpyxrdCweA//QIAYPu87/dY+PyS193CWskj4ZRz/XYReS8dazpVe4r9VYk0G4ym1dvkFoE9CZmCUVSAtQCYHpQOBRGR2cmSA5nOKD2Y4Pf1w+eX6+vrQ+KrkMui/vlyfnw6xAFSLCvxjAfgwOMrk8LgjKnIGrXv1W2DHfV3hPbQyr5xV62L9G8g7wsuXG7kzFO8aTf7+i6+vr2bZtm3VYgF/Vy+cedMfSSaTWv/QXMD7481Ncn6x1Unwq+EyBDO8+kRVS1azflX7Njo7/lpV72gRuCn5jR/UfyQiJ5sWkZlfzXoKkKnbcBVCuLQIXl4o6lbZqnTajZhNvf0HuNrNcUBv4raKNjyJJOKRivePNpq8/GrlUj5fr1drw7FYrFYFL/ti0MxtdbKjQRiM/3R/Elx4ZHZkZORNfbtefzMLXs5eWVN/bHsQysoP0mv+OwNwGJZPTHAkvnJXbdoOmlMXtlLTbRKUlF95ah78ynPg1YviA/jG/qpzxzPFkG5a5RNdd2z6lx1w4Tfgpd+H8tcHcFdfFBAqNwxDMxLtbQ0tJb/aQ/CX3CyYYcBtrb5Tt5Wxf1ZtRXn0JTwbBmISKhZ+brqd8fEW/HVTVS+uGCOK8uzngyeTw8qDC+CPfxUOSoAtnGcKTlz9rZ0hKCE/Xwb8tp3lcBjy8x1UF6uxF/lqJv9cmfk3/NoK3RywLoCPLFvtXhguUT2/FQwas2Bcf3YweU75PJ+p51cfl74C/3fGIkZw/Cb4yGEbzzVIxw/RWyyFwuaADedNvqr+Xl0G1WLOP7z/8wH8xooBG+Y0+VVTb8uHA1XwU/eX+o2gcQMk9Pv1g8l6cdSfy1WUf9mPwIXHjC30EMS40cb6LOn4gTQlbw+YZmgVvPIp+30XFyZXlcc134Hy7/IucGDfPXAzM9aACb93po0Lb0I0gJ52aUHdBnHv8z9unqvtPvftfwP5fQNQrIEL37rSb2haRPjBOOn4TW0DNOGBEtGPF4X9qRcF5atzmbxSQV0zcMfniiFAD36oIHzd0V9uTgQBPZjuXQT68Wj1We2RvbuYyTxUKn4oJXOqekmDi/eDwZW1HwUvKxu/cjhkhs1l2Jou6OGmd1wwQzCh1qeAyCyKxsDROAh7QBxUFAGbPrpQuREMQgXRLkEvFpRhyfiVgbTqBUBvZ8oM62bTz0DHHSieA7e0OaXrdtPPHLG4YfQjcYARUGu6igjr7xX0JOyKIbjEVy5+lo7B3IP6AYZhHZiNqo5hG75GFQhAbMFvXFgshUEqUxTKpNNacAntcAwiIByG9fp2dQTa7OwbcN3JN/A1oDeOHkLcChqiK/Sl4hcrIjD5VagfaBhuFuCyK0ASiwZ0XKAsoDJRJ22oIGAkLg97X3gkuQWf8bo1Aej1X4HD8NqSoUU0Q7uxBg6uThgRcBBEH7o5DhVEM/rfiiz6kIrf00kEJgTo4WEIkkDq0GoBi0YYobxgwQMoIYvqsveF0RbvtyeCgAoaYZfH4QjDYrJwA4uGcQNtpABEBkvIXVVkcxOJ+AXyeIyZILrB/BgkgaZOSMJ0WndR6pieCSVEnfLy4NwmpGRAekvX0DCE9PA4PA99FZYduA2DUGpYQtSfBDxYIn5zsDEA6WEnhv5JIl2+NICLNoQSKgsu4VTk4CGvLLAOS7Yg9U80wozgEhqHUEygaNyCKFfQ0CMqDX9EYHciifhZBUTP3ga/bBLmx+FQyY104AQWjRCihyHPoyPTI4l5BcEEjRXonyjDC2KSOFc2sLIgXdaogyMJ0ZLej2jKw89XBpJL2qSQXggleCBXHkBhD52gooElZBuDDdm/H9t+H0oYJKlbg06soQpEXbiNIh3ACmPjzSuYnoHAXh7HYLe+87xrefjZJtEGWF0QX93EkS6EA905IhpUQjDYZQD22AmqBPHIu1uwP9VPvBOLBkKpXiKioTESgvUk53XX8vArh6dwwhLiEzwm0Jl6gxrTg9XjLjw9gRMWFPYY72QCncZIiIGLECTNlzzrYGn4BbDMwqoDN1iId+Je1TxC6aqxyelJqHzMjMjIa5V4pOHm0A2BDqoxkhAMFh/cXQkGPfdXlIbfAq06QijSkQYL7VWFTFc0sIRwBzqvIOxiL6DqOCVGKR31Tg4lVeP7S/gUBosOkl5r9qXhN7OIqw7oxFQ0TAYllBBXjcNhvgjhUxhuufAdmO4B74QCskAaLNoKDnSIHpAQVHcgCQliBaF6EvRyYFn4+coDJuOQbqDDvSrYbkHagkXDZBQECvD2Q+5iLL+hVNDxzhUc21iUUELWVFScGEhB3AOkzV6bdMjCr1bkEjwHpY5K3gFGQng90Ym/c5Mh7L0mQcVLEjwutmHRYNWY6gkuQgjmXz0CoCz8rIFVNle2+FwZlXO4hMMHqDJ2uoBgWDoBsO/e/Lw6P38vQ47TTXPl4JFcmbS3zhM9CRLMKY8H5mThV4D95gtENPjYhgqSvB06qifMSHTagIFKpaLOVSo0pf4FbalDRIPENkJvCU93YHpETziwAHPEYy5JEn4+lXYF+NhG6o4ZiylCiJ7wasy1UZn4V6Ep3dHYBsHemuh3ixA8Rh0JwWmOx1SSJPyUyWWaK29yuTIu4XCuPOUegLDHlXD6HnsxVj9+Y3PlNTe2LVAJYQ6MRszgnEcTSxZ+ZUSPxDbcYBlgJMRt2IdQ2GMHKTo3yV6M4TcaD7aMbViN0YFbhGDM5Aicu3T8fcvCb8+EaYjK5MqcGnN6QsNeMcT0ZVpcdywOcj8yr0tzZUaN2cSZr+7oB28ef9/S8BsgsY3Q49SY1xN+kJJzrXqAY/EgiW0EColtrJ6Ms6cuc0e3rngk0LLwe8jGNr7BUnInzF0BpupCPhhuye8larCQ2GYwsY0oyFVOT65ONAbB0xH/fKTz4kiIWiii/jPbbeEF2NUa+MFW/AKtGizMAT0iJQl/7pSMvwvLbK5MGyyW221hCjqmL0PONeQvrL2mDRZGQujBCnvKKUlYrdE0j3l0WfiVw43eSQ9KNOy5tXGDG8OB2ZJfgmgBkpClJg170olxjtwPQkf22uFdFn62U8liCaEHdogJe7ihyn9QR13U1it6U26ufCXI5spOi6DVEcpmXnrMwcnCr1Y02ekO9qCBpXMO0yOZYcsZEMMgPfqjDXujsX3vJtWYHswMPdaqy8LP91BF6fGRhj3Pkp4jebSTGbZehzX2UqUS0tiwv8K375kjNzP0WoclDT/ao3eKkHC4sXPV0MyHyw9I9nfMFHCgVYOFb9+zR0xm2O+1klIWfkphlUxG4iLkaIuAL3n5Iq54zAzwbToZyRQhXIugYeELl/15ta/k4Qe3e8aTkU7DnuMFaLktLib7Kx6X/UEbSrkzk6TBQlcNHZ21ZLqoyOM994iWhh+o4BpyZbZFwOfRDUXcMdkftGh/Q3bMd2LYhS/UkZ3sz3MhtDz8atziFp2b8yWrsTCtI9mfefxDcRF2cQvHh1tDxOSC1JEFvp5QHn7Kc5rf8bUFHwSZ7I/SG7D3jr/wf9wGC9dl5pr5bvY34Rxvea9gk4iftUqn07gWAdt8gQOTy/5wSezxfHGaiIbWrMuMj9xc0M3+Lqmq9wOFEvFD37jAz/mG2FnLhpaq7jaoPXYHGI0bDS0CftayoaWKsxt0fLr41Sxuzrchj3YdmWR/dI7znOcCXiNJAl3DrCWl1c92UZ3JpPsiC3hl4qfYVELMJrS4LipzfkBgBf7hNbX5rGWz7M/YwivaNE3glqXipzBzvmwz3xGNC7Rl4NAMea4+hRZwG9DsrKXbN73tioaTOwt9QYNc/OZK/KxliIoGl/25lUfINMsCy+8V5fs0P2vp5MrMCnJ++kjwCxrk4ge/ccHkFp46nb97U27YgzQXME3R/RDSESqxTIOFWbOGRYNpsSbEduqVjJ9i69xEpdtFDdEwyPWdjyt8eUsYDRJLVhwsuWGQcWxD9NtpZOOnLKvH5cpsbggIiuNTlJ9Up+fcuOKAabGiXoNhpEUfAZaOn8I2WDhH5vvOZsgqtINP8dGFL43LnunzHmQFAhiIWynhrY7l4wdioMmUwNSRgaiwfVSUvZTau3Ay2fB8BysadPoIZjN3xHcpl5Af/MIAp1MackVDdeY4SWer3u6uQUH4JAMSiWtb/Y5o4KVWtLMFB2Ybu53JyE/xlRsaLKRdRaaPyNOEJ9hFZyje0GBhc2cyEH+40c4VpeSnKKtup7TxaRk8EJ+fcAOYLbdTyvdRyUD87m17G8BIyk/x22W82T3Xd6YD8WG7W28wF04nDDYM0j4qyl5ev213j3xZ+QEntveKpllkKg9S1P3+9OT0oI2loknDILmywZQlLz9t/xsG5OUHrGaXV9FUHO7owx051M9KJ9g3p9H6E/HXeJUBSvdg9nLn1/RJdmCTmh+wWKZQBmZZVrn8HChj1zaCn60exqPxRCqVmI7fUef9J/x6Btn5IfPFarVazOfLdfvCY0Ozs0NDo5UTbFxH7FTwk9h6/DqzHr/OrMevM+vx68x6/DqzHr/OrMevM+vx68x6/DqzHr/OrMevM+vx68za4NfXs6NWFecn/MmeNbP/B6BnoHPfQCagAAAAAElFTkSuQmCC)

## General informations
All the code needed to run the program is stored in the [Hausdorff_Dice.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Hausdorff_Dice.py) script.

[patients](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/tree/master/patients) folder contains three patients where the organs at risk were contoured manually and using a deep learning and a model based segmentation algorithms.

[tests](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/tree/master/tests) folder contains the data required to run [Tests.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Tests.py).

[Tests.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Tests.py) is the python script used for testing [Hausdorff_Dice.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Hausdorff_Dice.py).

[config.json](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/config.json) is a file containing the lists of manual segments names. If running the script new names for the five organs at risk are met they will be saved in this file.

## Prerequisites
The entire program is written in [python](https://www.python.org/downloads/), thus, it must be installed to execute it (python versions previous to 3.9.1 and next to 3.9.16 were not tested).

To open and read dicom files the libraries [pydicom](https://pypi.org/project/pydicom/) and [rt-utils](https://pypi.org/project/rt-utils/) must be installed.

To compute HD, DSC and SDCS the library [surface-distance](https://github.com/deepmind/surface-distance) must be installed. Also [git](https://git-scm.com/downloads) must be downloaded in order to clone the repository from github.

To save data into .xlsx files [openpyxl](https://pypi.org/project/openpyxl/) is needed.

Other libraries required are [numpy](https://numpy.org/install/) and [pandas](https://pandas.pydata.org/docs/getting_started/install.html).

## How to run
To run the program, the user has firstly to download the whole repository Hausdorff_Dice_Computation.
Then, the script Hausdorff_Dice.py can be run from command line by typing:

python path\to\Hausdorff_Dice.py path\to\patients\folder path\to\config.json path\to\excel_file.xlsx --new-folder path\to\the\folder\where\patients\will\be\moved --join-data True

The first three arguments are required:
* *path\to\patients\folder*: Is the path to the folder where patients folders are stored. **Do not put here directly the path to the folder containing .dcm files!**;
* *path\to\config.json*: Is the path to [config.json](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/config.json), a file that stores some important parameters like segment names;
* *path\to\excel_file.sxlsx*: Is the path to the file where the data will be saved after execution. If the file does not exist in the specified path it will be automatically created.

The last two argument are optional:
* *--new-folder path\to\the\folder\where\patients\will\be\moved*: Is the path where patient folders will be moved after execution. If not specified patient folders will remain in *path\to\input\folder*;
* *--join-data True*: If *True*, the new data extracted will be appended to ones already present in the excel file. if *False* (default), the data already in the excel file will be overwritten by the new ones.

## Testing
In order to run [Tests.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Tests.py) both [Tests.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Tests.py) file and [tests](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/tree/master/tests) folder must be downloaded.

Then the follwing paths inside [Tests.py](https://github.com/MarcoSaguatti/Hausdorff_Dice_Computation/blob/master/Tests.py) must be changed:
* *Path\to\tests\test_is_empty\empty_folder*: Is the path to an empty folder (any empty folder can be used);
* *Path\to\tests\test_is_empty\non_empty_folder*: Is the path to a non empty folder (any non empty folder can be used);
* *Path\to\tests\test_patient_info\RTSTRUCT\RS1.2.752.243.1.1.20230123144246076.4000.75633.dcm*: Is the path to the RTSTRUCT file contained in *tests\test_patient_info\RTSTRUCT*;
* *Path\to\tests\test_voxel_spacing\CT*: Is the path to the folder *tests\test_voxel_spacing_CT* that contains the dicom serie of one patient;
* *Path\to\config.json*: Is the path to the file *config.json*;
* *Path\to\tests\test_hausdorff_dice\input_folder*: Is the path to the folder *tests\test_hausdorff_dice\input_folder* that contains one patient to run *test_hausdorff_dice*;
* *Path\to\tests\test_hausdorff_dice\test.xlsx*: Is the path to *tests\test_hausdorff_dice\test.xlsx*, the excel file where the results of *test_hausdorff_dice* will be saved;
* *Path\to\tests\test_hausdorff_dice\new_folder*: Is the path to *tests\test_hausdorff_dice\new_folder*, the folder where patients will be moved after the execution of *test_hausdorff_dice*.

After downloading [pytest](https://pypi.org/project/pytest/), all the tests can be run from command line typing:

python -m pytest -v path/to/Tests.py